<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Little Soul Stories - Kids Religious Books</title>
    
    <!-- Google Fonts: Fredoka -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300..700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Tailwind Configuration -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Fredoka', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            purple: '#9b5de5',
                            pink: '#f15bb5',
                            yellow: '#fee440',
                            blue: '#00bbf9',
                            green: '#00f5d4'
                        }
                    },
                    animation: {
                        'bounce-short': 'bounce-short 0.5s infinite',
                        'wiggle': 'wiggle 2s ease-in-out infinite',
                        'pop-in': 'popIn 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards',
                        'spin-slow': 'spin 12s linear infinite',
                        
                        // Randomized Floating Animations
                        'float-random-1': 'floatY 6s ease-in-out infinite',          
                        'float-random-2': 'floatX 7s ease-in-out infinite',          
                        'float-random-3': 'floatDiag 5s ease-in-out infinite',       
                        'float-random-4': 'floatYReverse 5.5s ease-in-out infinite', 
                        'float-random-5': 'floatXReverse 8s ease-in-out infinite',   
                    },
                    keyframes: {
                        'bounce-short': {
                            '0%, 100%': { transform: 'translateY(-5%)' },
                            '50%': { transform: 'translateY(0)' },
                        },
                        floatY: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-15px)' },
                        },
                        floatYReverse: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(15px)' },
                        },
                        floatX: {
                            '0%, 100%': { transform: 'translateX(0)' },
                            '50%': { transform: 'translateX(15px)' },
                        },
                        floatXReverse: {
                            '0%, 100%': { transform: 'translateX(0)' },
                            '50%': { transform: 'translateX(-15px)' },
                        },
                        floatDiag: {
                            '0%, 100%': { transform: 'translate(0, 0)' },
                            '50%': { transform: 'translate(10px, -10px)' },
                        },
                        wiggle: {
                            '0%, 100%': { transform: 'rotate(-5deg)' },
                            '50%': { transform: 'rotate(5deg)' },
                        },
                        popIn: {
                            '0%': { transform: 'scale(0.5)', opacity: '0' },
                            '100%': { transform: 'scale(1)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 12px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 20px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        .btn-bouncy { transition: transform 0.1s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .btn-bouncy:active { transform: scale(0.9) !important; }
        .btn-bouncy:hover { transform: scale(1.05); }

        .card-hover { transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .card-hover:hover { transform: translateY(-8px) rotate(1deg); box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1); }

        .no-select { user-select: none; -webkit-user-select: none; }

        .toast-enter { transform: translateY(100%); opacity: 0; }
        .toast-enter-active { transform: translateY(0); opacity: 1; transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55); }
        .toast-exit { transform: translateY(100%); opacity: 0; transition: all 0.3s ease-in; }
    </style>
</head>
<body class="bg-slate-50 font-sans text-slate-800 no-select min-h-screen flex flex-col overflow-x-hidden">

    <!-- Header -->
    <header id="main-header" class="sticky top-0 z-50 bg-white/95 backdrop-blur-sm border-b-4 border-slate-100 transition-colors duration-500 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <div class="flex items-center cursor-pointer btn-bouncy" onclick="router.navigate('home')">
                    <div class="bg-brand-purple text-white p-2 rounded-2xl mr-3 shadow-lg transform -rotate-3">
                        <i data-lucide="heart-handshake" class="w-8 h-8"></i>
                    </div>
                    <span class="text-2xl md:text-3xl font-bold tracking-tight text-slate-800 leading-none">Little Soul <span class="text-brand-pink">Stories</span></span>
                </div>
                <div class="flex items-center space-x-3 md:space-x-4">
                    <button onclick="router.navigate('home')" class="p-3 rounded-2xl bg-slate-100 hover:bg-brand-blue hover:text-white transition-colors duration-300 btn-bouncy">
                        <i data-lucide="home" class="w-6 h-6 md:w-7 md:h-7"></i>
                    </button>
                    <button onclick="cart.toggle()" class="relative p-3 rounded-2xl bg-brand-yellow text-slate-900 hover:bg-yellow-400 transition-colors duration-300 btn-bouncy shadow-md">
                        <i data-lucide="shopping-cart" class="w-6 h-6 md:w-7 md:h-7"></i>
                        <span id="cart-badge" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold w-6 h-6 flex items-center justify-center rounded-full border-2 border-white transform scale-0 transition-transform duration-300">0</span>
                    </button>
                </div>
            </div>
        </div>
        <div id="category-header" class="hidden w-full py-2 text-center text-white font-bold text-lg shadow-inner transition-colors duration-500">
            <span id="category-title-text">Category</span>
        </div>
    </header>

    <!-- Main Content -->
    <main id="app" class="flex-grow w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 relative min-h-[600px]">
        <!-- Dynamic Content -->
    </main>

    <!-- Footer -->
    <footer class="bg-white border-t-4 border-slate-100 mt-auto relative z-10 overflow-hidden">
        <div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8 relative z-20">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <p class="text-slate-400 font-medium text-center md:text-left mb-4 md:mb-0">&copy; 2024 Little Soul Stories. Melbourne, VIC.</p>
                <div class="flex space-x-6">
                    <div class="p-2 bg-slate-100 rounded-full text-slate-400 hover:bg-brand-purple hover:text-white transition-colors cursor-pointer btn-bouncy"><i data-lucide="instagram" class="w-6 h-6"></i></div>
                    <div class="p-2 bg-slate-100 rounded-full text-slate-400 hover:bg-brand-blue hover:text-white transition-colors cursor-pointer btn-bouncy"><i data-lucide="facebook" class="w-6 h-6"></i></div>
                </div>
            </div>
        </div>
        <div class="absolute bottom-0 right-10 opacity-20 transform translate-y-1/3 z-0 text-brand-purple animate-float-random-5">
             <svg width="200" height="200" viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M100 180C144.183 180 180 144.183 180 100C180 55.8172 144.183 20 100 20C55.8172 20 20 55.8172 20 100C20 144.183 55.8172 180 100 180Z" fill="currentColor"/><path d="M70 90C75.5228 90 80 85.5228 80 80C80 74.4772 75.5228 70 70 70C64.4772 70 60 74.4772 60 80C60 85.5228 64.4772 90 70 90Z" fill="white"/><path d="M130 90C135.523 90 140 85.5228 140 80C140 74.4772 135.523 70 130 70C124.477 70 120 74.4772 120 80C120 85.5228 124.477 90 130 90Z" fill="white"/><path d="M100 140C120 140 135 125 135 125" stroke="white" stroke-width="8" stroke-linecap="round"/></svg>
        </div>
    </footer>

    <!-- Cart Modal -->
    <div id="cart-modal" class="fixed inset-0 z-[100] hidden">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm transition-opacity" onclick="cart.toggle()"></div>
        <div class="absolute right-0 top-0 h-full w-full sm:w-[400px] bg-white shadow-2xl transform transition-transform duration-300 translate-x-full flex flex-col" id="cart-panel">
            <div class="p-6 bg-brand-yellow flex justify-between items-center shadow-sm">
                <div class="flex items-center"><i data-lucide="shopping-bag" class="w-8 h-8 mr-3 text-slate-800"></i><h2 class="text-2xl font-bold text-slate-800">Your Cart</h2></div>
                <button onclick="cart.toggle()" class="p-2 bg-white/50 rounded-full hover:bg-white text-slate-800 transition-colors btn-bouncy"><i data-lucide="x" class="w-6 h-6"></i></button>
            </div>
            <div id="cart-items" class="flex-1 overflow-y-auto p-6 space-y-4"></div>
            <div class="p-6 bg-slate-50 border-t-2 border-slate-100">
                <div class="flex justify-between items-center mb-4"><span class="text-xl text-slate-500 font-bold">Total</span><span id="cart-total" class="text-3xl font-bold text-brand-purple">$0.00</span></div>
                <button class="w-full bg-brand-green text-white font-bold text-xl py-4 rounded-3xl shadow-[0_6px_0_rgb(6,155,133)] hover:shadow-[0_4px_0_rgb(6,155,133)] hover:translate-y-[2px] active:translate-y-[6px] active:shadow-none transition-all flex justify-center items-center group">
                    <span>Checkout</span><i data-lucide="arrow-right" class="ml-2 w-6 h-6 group-hover:translate-x-1 transition-transform"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="fixed bottom-6 left-1/2 transform -translate-x-1/2 z-[110] flex flex-col items-center pointer-events-none space-y-2 w-full max-w-sm px-4"></div>

    <script>
        // --- ASSETS (Cute Mascots) ---

        const cartoons = {
            sun: `<svg viewBox="0 0 200 200" class="w-full h-full text-brand-yellow drop-shadow-lg"><circle cx="100" cy="100" r="60" fill="currentColor"/><g stroke="currentColor" stroke-width="8" stroke-linecap="round"><line x1="100" y1="20" x2="100" y2="5"/><line x1="100" y1="180" x2="100" y2="195"/><line x1="180" y1="100" x2="195" y2="100"/><line x1="20" y1="100" x2="5" y2="100"/><line x1="156.57" y1="43.43" x2="167.18" y2="32.82"/><line x1="43.43" y1="156.57" x2="32.82" y2="167.18"/><line x1="156.57" y1="156.57" x2="167.18" y2="167.18"/><line x1="43.43" y1="43.43" x2="32.82" y2="32.82"/></g><circle cx="80" cy="90" r="6" fill="#334155"/><circle cx="120" cy="90" r="6" fill="#334155"/><path d="M80 120 Q100 135 120 120" stroke="#334155" stroke-width="5" fill="none" stroke-linecap="round"/></svg>`,
            cloud: `<svg viewBox="0 0 200 120" class="w-full h-full text-brand-blue drop-shadow-md"><path d="M40 100C18 100 0 82 0 60C0 38 18 20 40 20C45 20 50 21 54 24C62 10 76 0 92 0C116 0 136 16 142 38C148 36 154 34 160 34C182 34 200 52 200 74C200 96 182 114 160 114H40C29 114 20 105 20 94C20 83 29 74 40 74H40" fill="#E0F2FE"/><circle cx="70" cy="60" r="5" fill="#334155"/><circle cx="110" cy="60" r="5" fill="#334155"/><path d="M85 75 Q90 80 95 75" stroke="#334155" stroke-width="3" fill="none" stroke-linecap="round"/></svg>`,
            moon: `<svg viewBox="0 0 200 200" class="w-full h-full text-brand-purple drop-shadow-lg"><path d="M80 20 A80 80 0 1 0 180 120 A60 60 0 1 1 80 20" fill="#f1f5f9" stroke="#94a3b8" stroke-width="4"/><circle cx="120" cy="90" r="5" fill="#334155"/><path d="M120 120 Q140 130 160 110" stroke="#334155" stroke-width="4" fill="none" stroke-linecap="round"/></svg>`,
            star: `<svg viewBox="0 0 200 200" class="w-full h-full text-brand-yellow drop-shadow-lg"><path d="M100 10L125 70H190L140 110L160 170L100 135L40 170L60 110L10 70H75L100 10Z" fill="#FDE047" stroke="#EAB308" stroke-width="5"/><circle cx="85" cy="95" r="5" fill="#334155"/><circle cx="115" cy="95" r="5" fill="#334155"/><path d="M90 115 Q100 125 110 115" stroke="#334155" stroke-width="3" fill="none" stroke-linecap="round"/></svg>`,
            book: `<svg viewBox="0 0 200 200" class="w-full h-full"><rect x="40" y="30" width="120" height="150" rx="10" fill="#f472b6"/><rect x="50" y="30" width="10" height="150" fill="#be185d"/><rect x="70" y="50" width="80" height="90" fill="white" rx="5"/><circle cx="90" cy="80" r="5" fill="#334155"/><circle cx="130" cy="80" r="5" fill="#334155"/><path d="M100 100 Q110 110 120 100" stroke="#334155" stroke-width="3" fill="none" stroke-linecap="round"/><path d="M50 160 L150 160" stroke="white" stroke-width="5" stroke-linecap="round"/></svg>`
        };

        // Data: Updated with History & Learning
        const categoriesData = [
            { 
                id: 'christianity', name: 'Christianity',
                message: "Love, forgiveness, and kindness to neighbors.",
                history: "Originating in the 1st century, this faith is based on the life and teachings of Jesus of Nazareth. It has grown into a global tradition celebrating love and redemption.",
                learning: "Kids discover the power of forgiveness, loving their neighbors, and compassion.",
                color: 'bg-blue-500', accent: 'text-blue-500', bgLight: 'bg-blue-50', border: 'border-blue-500', btnColor: 'bg-blue-500',
                icon: 'cross',
                mascot: cartoons.cloud 
            },
            { 
                id: 'islam', name: 'Islam',
                message: "Peace, charity, and love for the Creator.",
                history: "Revealed to the Prophet Muhammad in the 7th century, Islam emphasizes belief in one God and living a righteous life. It is a faith rich in history, charity, and daily devotion.",
                learning: "Children learn about patience, the importance of charity (Zakat), and gratitude.", 
                color: 'bg-emerald-500', accent: 'text-emerald-500', bgLight: 'bg-emerald-50', border: 'border-emerald-500', btnColor: 'bg-emerald-500',
                icon: 'moon',
                mascot: cartoons.moon 
            },
            { 
                id: 'buddhism', name: 'Buddhism',
                message: "Compassion, mindfulness, and inner peace.",
                history: "Founded by Siddhartha Gautama in ancient India, Buddhism teaches the path to enlightenment and peace. It focuses on mindfulness, wisdom, and kindness to all living things.",
                learning: "Little ones explore mindfulness, finding inner peace, and kindness to nature.",
                color: 'bg-rose-500', accent: 'text-rose-500', bgLight: 'bg-rose-50', border: 'border-rose-500', btnColor: 'bg-rose-500',
                icon: 'flower',
                mascot: cartoons.sun 
            },
            { 
                id: 'hinduism', name: 'Hinduism',
                message: "Truth, dharma, and seeing God in everyone.",
                history: "As one of the world's oldest religions, Hinduism has roots in ancient India dating back thousands of years. It celebrates a vast tapestry of gods, festivals, and the duty of Dharma.",
                learning: "Kids discover colorful festivals, the importance of duty, and respecting all life.",
                color: 'bg-orange-500', accent: 'text-orange-500', bgLight: 'bg-orange-50', border: 'border-orange-500', btnColor: 'bg-orange-500',
                icon: 'sun',
                mascot: cartoons.sun
            },
            { 
                id: 'sikhism', name: 'Sikhism',
                message: "Equality, service to others, and honest living.",
                history: "Founded in the 15th century by Guru Nanak in the Punjab region, Sikhism champions equality and devotion. It teaches that everyone is equal before one God and emphasizes community service.",
                learning: "Children learn about equality, bravery, and the joy of serving others (Seva).",
                color: 'bg-yellow-500', accent: 'text-yellow-600', bgLight: 'bg-yellow-50', border: 'border-yellow-500', btnColor: 'bg-yellow-500',
                icon: 'sun-snow',
                mascot: cartoons.star 
            },
            { 
                id: 'judaism', name: 'Judaism',
                message: "Justice, tradition, and healing the world.",
                history: "This ancient monotheistic faith is rooted in the covenant between God and the Jewish people. With a history spanning thousands of years, it cherishes law, tradition, and study.",
                learning: "Kids learn about rich traditions, the importance of family, and healing the world.",
                color: 'bg-indigo-500', accent: 'text-indigo-500', bgLight: 'bg-indigo-50', border: 'border-indigo-500', btnColor: 'bg-indigo-500',
                icon: 'star',
                mascot: cartoons.star
            }
        ];

        const categories = categoriesData.reduce((acc, cat) => { acc[cat.id] = cat; return acc; }, {});

        const products = [
            { id: 8, category: 'christianity', title: 'Noah\'s Ark', part: 'Part 1', price: 10.99, image: 'bg-blue-200' },
            { id: 9, category: 'christianity', title: 'Christmas Star', part: 'Special', price: 12.50, image: 'bg-blue-300' },
            { id: 20, category: 'christianity', title: 'The Good Samaritan', part: 'Part 2', price: 11.50, image: 'bg-blue-200' },
            { id: 1, category: 'islam', title: 'Prophet Stories', part: 'Part 1', price: 12.99, image: 'bg-emerald-200' },
            { id: 2, category: 'islam', title: 'Ramadan Fun', part: 'Special', price: 14.99, image: 'bg-emerald-300' },
            { id: 3, category: 'islam', title: 'Little Prayer Book', part: 'Part 1', price: 9.99, image: 'bg-emerald-400' },
            { id: 14, category: 'buddhism', title: 'Little Buddha', part: 'Part 1', price: 11.99, image: 'bg-rose-200' },
            { id: 15, category: 'buddhism', title: 'Mindful Monkey', part: 'Part 1', price: 10.99, image: 'bg-rose-300' },
            { id: 16, category: 'buddhism', title: 'Lotus Pond', part: 'Special', price: 12.99, image: 'bg-rose-200' },
            { id: 5, category: 'hinduism', title: 'Little Krishna', part: 'Part 1', price: 11.99, image: 'bg-orange-200' },
            { id: 6, category: 'hinduism', title: 'Diwali Lights', part: 'Special', price: 15.99, image: 'bg-orange-300' },
            { id: 7, category: 'hinduism', title: 'Ramayana Tales', part: 'Part 1', price: 13.99, image: 'bg-orange-400' },
            { id: 10, category: 'sikhism', title: 'Guru Nanak', part: 'Part 1', price: 12.99, image: 'bg-yellow-200' },
            { id: 11, category: 'sikhism', title: 'Vaisakhi Joy', part: 'Special', price: 11.99, image: 'bg-yellow-300' },
            { id: 12, category: 'judaism', title: 'Hanukkah Lights', part: 'Special', price: 14.50, image: 'bg-indigo-200' },
            { id: 13, category: 'judaism', title: 'Moses', part: 'Part 1', price: 13.00, image: 'bg-indigo-300' },
        ];

        const state = { view: 'home', category: null, cart: [] };

        // --- COMPONENTS ---

        const components = {
            categoryCard: (cat) => `
                <div onclick="router.navigate('category', '${cat.id}')" 
                     class="group relative bg-white rounded-[32px] p-6 cursor-pointer shadow-[0_10px_0_rgba(0,0,0,0.05)] hover:shadow-[0_15px_30px_rgba(0,0,0,0.1)] border-4 border-transparent hover:border-${cat.color.replace('bg-', '')} transition-all duration-300 transform hover:-translate-y-2 flex flex-col items-center justify-center h-48 sm:h-56 w-full overflow-hidden z-10">
                    <div class="${cat.color} w-20 h-20 rounded-full flex items-center justify-center text-white mb-4 shadow-lg group-hover:scale-110 transition-transform duration-300 animate-bounce-short relative z-20">
                        <i data-lucide="${cat.icon}" class="w-10 h-10"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-slate-700 group-hover:${cat.accent} relative z-20">${cat.name}</h3>
                    <div class="mt-2 text-slate-400 font-medium text-sm relative z-20">Tap to explore</div>
                </div>
            `,

            productCard: (product, theme, label = null) => `
                <div class="bg-white rounded-[24px] p-4 shadow-lg border-2 border-slate-100 card-hover flex flex-col animate-pop-in relative h-full">
                    ${label ? `<div class="absolute -top-3 -right-3 bg-brand-yellow text-yellow-900 text-xs font-bold px-3 py-1 rounded-full shadow-sm animate-bounce-short z-30 ring-2 ring-white">${label}</div>` : ''}
                    <div class="relative w-full aspect-[3/4] ${product.image} rounded-2xl mb-4 overflow-hidden flex items-center justify-center group">
                         <i data-lucide="book" class="w-16 h-16 text-white/50 transform group-hover:scale-110 transition-transform duration-500"></i>
                         <div class="absolute top-3 left-3 bg-white/90 backdrop-blur-sm px-3 py-1 rounded-full text-xs font-bold text-slate-600 shadow-sm">
                            ${product.part}
                         </div>
                    </div>
                    <div class="flex-grow">
                        <h3 class="text-xl font-bold text-slate-800 leading-tight mb-1 line-clamp-2">${product.title}</h3>
                        <p class="text-slate-400 text-sm mb-3">Softcover â€¢ Illustrated</p>
                    </div>
                    <div class="flex justify-between items-center mt-2">
                        <span class="text-2xl font-bold ${theme.accent}">$${product.price}</span>
                        <button onclick="cart.add(${product.id})" class="${theme.btnColor} text-white p-3 rounded-xl shadow-md hover:shadow-lg active:scale-90 transition-all duration-200">
                            <i data-lucide="plus" class="w-6 h-6"></i>
                        </button>
                    </div>
                </div>
            `,
            
            parentFeatureCard: (icon, title, desc, color) => `
                <div class="bg-${color}-50 rounded-3xl p-6 text-center transform hover:scale-105 transition-transform duration-300 relative overflow-visible z-10">
                    <div class="bg-white w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 shadow-sm text-${color}-500 relative z-10">
                        <i data-lucide="${icon}" class="w-8 h-8"></i>
                    </div>
                    <h3 class="text-xl font-bold text-slate-800 mb-2 relative z-10">${title}</h3>
                    <p class="text-slate-500 leading-relaxed text-sm relative z-10">${desc}</p>
                </div>
            `
        };

        // --- APP LOGIC ---

        const router = {
            navigate: (view, param = null) => {
                state.view = view;
                state.category = param;
                const header = document.getElementById('main-header');
                const catHeader = document.getElementById('category-header');
                const catTitle = document.getElementById('category-title-text');
                
                if (view === 'category' && param && categories[param]) {
                    const theme = categories[param];
                    catHeader.classList.remove('hidden');
                    catHeader.className = `w-full py-3 text-center text-white font-bold text-xl shadow-inner transition-colors duration-500 ${theme.color}`;
                    catTitle.innerText = `Browsing: ${theme.name}`;
                } else {
                    catHeader.classList.add('hidden');
                }
                window.scrollTo({ top: 0, behavior: 'smooth' });
                render();
            }
        };

        const cart = {
            add: (id) => {
                const product = products.find(p => p.id === id);
                if (product) {
                    state.cart.push(product);
                    cart.updateUI();
                    ui.toast(`Added ${product.title} to cart!`);
                }
            },
            remove: (index) => {
                state.cart.splice(index, 1);
                cart.updateUI();
            },
            toggle: () => {
                const modal = document.getElementById('cart-modal');
                const panel = document.getElementById('cart-panel');
                if (modal.classList.contains('hidden')) {
                    modal.classList.remove('hidden');
                    setTimeout(() => panel.classList.remove('translate-x-full'), 10);
                } else {
                    panel.classList.add('translate-x-full');
                    setTimeout(() => modal.classList.add('hidden'), 300);
                }
            },
            updateUI: () => {
                const badge = document.getElementById('cart-badge');
                badge.innerText = state.cart.length;
                badge.className = state.cart.length > 0 ? "absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold w-6 h-6 flex items-center justify-center rounded-full border-2 border-white transform scale-100 animate-bounce-short transition-transform duration-300" : "hidden";
                
                const total = state.cart.reduce((sum, item) => sum + item.price, 0);
                document.getElementById('cart-total').innerText = `$${total.toFixed(2)}`;

                const container = document.getElementById('cart-items');
                if (state.cart.length === 0) {
                    container.innerHTML = `<div class="flex flex-col items-center justify-center h-full text-slate-400 opacity-50"><i data-lucide="shopping-cart" class="w-16 h-16 mb-4"></i><p class="text-xl font-bold">Your cart is empty!</p></div>`;
                } else {
                    container.innerHTML = state.cart.map((item, index) => `
                        <div class="flex items-center bg-white p-3 rounded-xl border border-slate-100 shadow-sm animate-pop-in">
                            <div class="w-16 h-16 ${item.image} rounded-lg flex-shrink-0 mr-4"></div>
                            <div class="flex-grow"><h4 class="font-bold text-slate-800">${item.title}</h4><p class="text-sm text-slate-400">${item.part}</p></div>
                            <div class="flex flex-col items-end"><span class="font-bold text-brand-purple mb-1">$${item.price}</span><button onclick="cart.remove(${index})" class="text-slate-300 hover:text-red-500 transition-colors p-1"><i data-lucide="trash-2" class="w-5 h-5"></i></button></div>
                        </div>`).join('');
                }
                lucide.createIcons();
            }
        };

        const ui = {
            toast: (message) => {
                const container = document.getElementById('toast-container');
                const el = document.createElement('div');
                el.className = 'bg-slate-800 text-white px-6 py-3 rounded-full font-bold shadow-2xl flex items-center toast-enter pointer-events-auto';
                el.innerHTML = `<i data-lucide="check-circle" class="w-5 h-5 text-green-400 mr-2"></i> ${message}`;
                container.appendChild(el);
                lucide.createIcons();
                setTimeout(() => el.classList.add('toast-enter-active'), 10);
                setTimeout(() => { el.classList.remove('toast-enter-active'); el.classList.add('toast-exit'); setTimeout(() => el.remove(), 300); }, 3000);
            }
        };

        // --- RENDERERS ---

        function render() {
            const app = document.getElementById('app');
            app.innerHTML = ''; // Clear
            
            if (state.view === 'home') renderHome(app);
            else if (state.view === 'category') renderCategoryPage(app);
            
            lucide.createIcons();
        }

        function renderHome(container) {
            let html = `
                <!-- Hero Section with Mascots -->
                <div class="relative py-12 text-center mb-8 mt-4 animate-pop-in z-10">
                    <!-- Animated Mascots -->
                    <div class="absolute top-0 right-10 w-24 h-24 animate-spin-slow hidden md:block opacity-90">
                        <div class="animate-float-random-1">${cartoons.sun}</div>
                    </div>
                    
                    <!-- New: Moon Top Left -->
                    <div class="absolute top-2 left-8 w-20 h-20 animate-float-random-4 hidden md:block opacity-80">
                        ${cartoons.moon}
                    </div>

                    <div class="absolute bottom-0 left-10 w-32 h-20 animate-float-random-2 hidden md:block">${cartoons.cloud}</div>
                    
                    <!-- New: Extra Cloud Right Side -->
                    <div class="absolute top-24 right-1/4 w-28 h-18 animate-float-random-5 hidden lg:block opacity-60">
                         ${cartoons.cloud}
                    </div>

                    <div class="absolute top-10 left-1/4 w-16 h-16 animate-float-random-3 hidden sm:block opacity-80">${cartoons.star}</div>

                    <!-- New: Extra Star Bottom Right -->
                    <div class="absolute bottom-8 right-20 w-12 h-12 animate-float-random-3 hidden sm:block opacity-70">
                        ${cartoons.star}
                    </div>

                    <!-- New: Book Character -->
                    <div class="absolute -bottom-4 left-1/3 w-14 h-14 animate-float-random-1 hidden md:block opacity-90 transform -rotate-6">
                         ${cartoons.book}
                    </div>
                    
                    <h1 class="text-4xl md:text-6xl font-extrabold text-slate-800 mb-4 tracking-tight relative z-20">
                        Little Stories for <span class="text-brand-pink inline-block animate-bounce-short">Little</span> Souls
                    </h1>
                    <p class="text-xl text-slate-500 max-w-2xl mx-auto relative z-20">
                        Discover beautiful books about faith, kindness, and adventure. 
                    </p>
                </div>

                <!-- Categories Grid -->
                <div class="relative z-10 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-20">
                    ${categoriesData.map(cat => components.categoryCard(cat)).join('')}
                </div>

                <!-- Community Favorites (Corrected Grid Size) -->
                <div class="relative z-10 mb-20">
                    <div class="flex items-center mb-6 justify-center md:justify-start">
                        <div class="w-12 h-12 mr-3 animate-wiggle">${cartoons.star}</div>
                        <h2 class="text-3xl font-bold text-slate-800">Community Favorites</h2>
                    </div>
                    
                    <!-- GRID MATCHING CATEGORY PAGE: grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 -->
                    <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-6">
                        ${categoriesData.slice(0, 4).map(cat => {
                            const bestSeller = products.find(p => p.category === cat.id);
                            return bestSeller ? components.productCard(bestSeller, cat, "Favorite") : '';
                        }).join('')}
                    </div>
                </div>
            
                <!-- Parent Value Section -->
                <div class="relative z-10 bg-white rounded-[40px] p-8 md:p-12 mb-20 shadow-[0_10px_40px_-10px_rgba(0,0,0,0.05)] border-4 border-slate-50 overflow-visible">
                    <!-- Mascots peeking over container -->
                    <div class="absolute -top-12 -left-4 w-24 h-24 animate-float-random-4 z-20">${cartoons.book}</div>
                    <div class="absolute -bottom-10 -right-6 w-32 h-20 animate-float-random-2 z-20">${cartoons.cloud}</div>

                    <div class="text-center mb-10 relative z-10">
                        <span class="bg-brand-yellow/20 text-yellow-700 px-4 py-2 rounded-full font-bold text-sm tracking-wide uppercase">For Parents</span>
                        <h2 class="text-3xl md:text-4xl font-extrabold text-slate-800 mt-4">Why Families Trust Us</h2>
                        <p class="text-slate-500 mt-2 max-w-xl mx-auto">Safe, engaging, and meaningful content for your children.</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 relative z-10">
                        ${components.parentFeatureCard('shield-check', 'Safe & Wholesome', 'Every book is carefully vetted. No scary surprises, just pure lessons.', 'emerald')}
                        ${components.parentFeatureCard('heart', 'Rooted in Culture', 'Connect your children to their heritage with stories that celebrate traditions.', 'pink')}
                        ${components.parentFeatureCard('smile', 'Fun Learning', 'Vibrant art and bouncy rhymes make learning a joy.', 'blue')}
                    </div>
                </div>
            `;
            container.innerHTML = html;
        }

        function renderCategoryPage(container) {
            const catKey = state.category;
            const catData = categories[catKey];
            const catProducts = products.filter(p => p.category === catKey);

            let html = `
                <div class="relative z-10 mb-8">
                     <!-- Back Button -->
                    <div class="flex items-center cursor-pointer text-slate-400 hover:text-slate-600 transition-colors w-fit group mb-6" onclick="router.navigate('home')">
                        <div class="bg-white p-3 rounded-full shadow-sm mr-3 group-hover:scale-110 transition-transform">
                            <i data-lucide="arrow-left" class="w-5 h-5"></i>
                        </div>
                        <span class="font-bold text-lg">Back</span>
                    </div>

                    <!-- Enhanced Category Header Card -->
                    <div class="bg-white rounded-[40px] p-8 md:p-10 shadow-sm border-2 border-slate-100 relative overflow-hidden animate-pop-in">
                        <!-- Faint Background Mascot -->
                        <div class="absolute -right-10 -bottom-10 w-64 h-64 opacity-5 pointer-events-none transform rotate-12">${catData.mascot}</div>

                        <div class="relative z-10 flex flex-col md:flex-row items-center md:items-start gap-8">
                            <!-- Floating Mascot Left -->
                            <div class="w-32 h-32 flex-shrink-0 animate-float-random-1">
                                ${catData.mascot}
                            </div>
                            
                            <!-- Text Content -->
                            <div class="text-center md:text-left flex-grow">
                                <h2 class="text-4xl font-extrabold text-slate-800 mb-3">${catData.name}</h2>
                                
                                <p class="text-slate-500 mb-6 text-lg leading-relaxed max-w-3xl">
                                    <span class="font-bold text-slate-700">History:</span> ${catData.history}
                                </p>
                                
                                <div class="flex flex-col sm:flex-row gap-4 justify-center md:justify-start flex-wrap">
                                     <!-- Learning Pill -->
                                    <div class="bg-brand-yellow/20 text-yellow-800 px-6 py-4 rounded-2xl text-lg font-bold flex items-center shadow-sm">
                                        <i data-lucide="lightbulb" class="w-6 h-6 mr-3 flex-shrink-0"></i>
                                        <span>What kids learn: ${catData.learning}</span>
                                    </div>
                                    <!-- Core Message Pill -->
                                    <div class="${catData.bgLight} ${catData.accent} px-6 py-4 rounded-2xl text-lg font-bold flex items-center border ${catData.border} border-opacity-30 shadow-sm">
                                        <i data-lucide="heart" class="w-6 h-6 mr-3 flex-shrink-0"></i>
                                        <span>"${catData.message}"</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="relative z-10 grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-6">
            `;

            if (catProducts.length > 0) {
                html += catProducts.map(p => components.productCard(p, catData)).join('');
            } else {
                html += `
                    <div class="col-span-full flex flex-col items-center justify-center py-20 text-slate-400 bg-white rounded-3xl border-2 border-dashed border-slate-200">
                        <div class="w-24 h-24 mb-4 opacity-50 grayscale animate-pulse">${cartoons.book}</div>
                        <h3 class="text-2xl font-bold">More Stories Coming Soon!</h3>
                        <p>We are stocking up the shelves.</p>
                    </div>
                `;
            }

            html += `</div>`;
            container.innerHTML = html;
        }

        window.onload = () => render();

    </script>
</body>
</html>
